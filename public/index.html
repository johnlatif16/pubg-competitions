<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تسجيل المسابقة</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0; background:#0b1220; color:#e9eefc}
    .wrap{max-width:900px; margin:0 auto; padding:28px}
    .card{background:#121a2c; border:1px solid #263252; border-radius:14px; padding:18px}
    h1{margin:0 0 10px}
    p{line-height:1.7; margin:8px 0}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
    label{display:block; font-size:14px; opacity:.9; margin:10px 0 6px}
    input,textarea{width:100%; padding:12px; border-radius:10px; border:1px solid #2a3a62; background:#0c1427; color:#e9eefc}
    textarea{min-height:90px; resize:vertical}
    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:14px}
    button{padding:12px 16px; border-radius:12px; border:0; background:#4f7cff; color:white; font-weight:700; cursor:pointer}
    button:disabled{opacity:.6; cursor:not-allowed}
    .ghost{background:transparent; border:1px solid #2a3a62}
    .msg{margin-top:12px; padding:12px; border-radius:12px; display:none}
    .ok{background:#0f2a1b; border:1px solid #1f6a3a}
    .err{background:#2a1010; border:1px solid #7a2222}
    .top{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap}
    a{color:#9fb7ff}
    .badge{display:inline-block; padding:6px 10px; border-radius:999px; background:#0c1427; border:1px solid #2a3a62; font-size:12px}
    .hint{opacity:.85; font-size:13px; margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <h1>تسجيل بطولات / رومات</h1>
      <a href="/login">دخول الأدمن</a>
    </div>

    <div class="card" style="margin-bottom:14px">
      <span class="badge">وصف الجروب</span>
      <p>
        الجروب مخصص ل بطولات و رومات كل فتره علي حسب عدد الافراد الموجودين علي شدت
        من فردي 325 شده ل رباعي 660 شده بالتوفيق ان شاء الله
      </p>
      <p style="opacity:.9">املأ البيانات للتسجيل في المسابقة الحالية.</p>
    </div>

    <div class="card">
      <form id="regForm">
        <div class="grid">
          <div>
            <label>الاسم بالكامل *</label>
            <input name="fullName" required placeholder="مثال: أحمد محمد" />
          </div>

          <div>
            <label>رقم الموبايل / واتساب *</label>
            <input name="phone" required placeholder="مثال: 010xxxxxxxx" />
          </div>

          <div>
            <label>الإيميل (اختياري)</label>
            <input name="email" type="email" placeholder="name@example.com" />
          </div>

          <div>
            <label>ID اللعبة *</label>
            <input name="gameId" required placeholder="اكتب الـ ID" />
          </div>
        </div>

        <label>اسم اللاعب / أسماء اللاعبين (اسم الأكونت) *</label>
        <textarea name="notes" required placeholder="اكتب أسماء اللاعبين هنا..."></textarea>
        <div class="hint">
          لو الروم فردي: اكتب اسم واحد — لو ثنائي: اسمين — لو رباعي: 4 أسماء.
        </div>

        <div class="actions">
          <button id="btnSubmit" type="submit">تسجيل</button>
          <button class="ghost" type="reset">مسح</button>
        </div>

        <div id="msgOk" class="msg ok"></div>
        <div id="msgErr" class="msg err"></div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById("regForm");
    const btn = document.getElementById("btnSubmit");
    const okBox = document.getElementById("msgOk");
    const errBox = document.getElementById("msgErr");

    function show(box, text) {
      box.textContent = text;
      box.style.display = "block";
    }
    function hide(box){ box.style.display = "none"; }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      hide(okBox); hide(errBox);

      btn.disabled = true;
      try {
        const data = Object.fromEntries(new FormData(form).entries());

        const res = await fetch("/api/register", {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(data)
        });

        const txt = await res.text();
        let out;
        try { out = JSON.parse(txt); }
        catch { out = { error: txt || "Non-JSON response" }; }

        if (!res.ok) throw new Error(out.error || "حدث خطأ");

        show(okBox, "✅ تم التسجيل بنجاح! بالتوفيق ✨");
        form.reset();
      } catch (err) {
        show(errBox, "❌ " + err.message);
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
